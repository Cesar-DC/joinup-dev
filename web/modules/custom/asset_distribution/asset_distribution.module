<?php

/**
 * @file
 * Contains asset_distribution.module.
 */

use \Drupal\Core\Entity\EntityInterface;
use \Drupal\rdf_entity\RdfInterface;

/**
 * Implements hook_ENTITY_TYPE_presave().
 *
 * Handle the reverse reference of the solution-distribution entities.
 */
function asset_distribution_rdf_entity_presave(EntityInterface $entity) {
  if ($entity->bundle() != 'asset_distribution') {
    return;
  }
  // Handle reverse reference in the interoperability solution.
  /** @var \Drupal\rdf_entity\RdfInterface $rdf_entity */
  $rdf_entity = \Drupal::routeMatch()->getParameter('rdf_entity');
  if ($rdf_entity instanceof RdfInterface && $rdf_entity->bundle() == 'solution') {
    $assigned_distributions = $rdf_entity->get('field_is_distribution')
      ->getValue();
    $assigned_distributions[]['target_id'] = $entity->id();
    $rdf_entity->set('field_is_distribution', $assigned_distributions);
    $rdf_entity->save();
  }
}
